"use strict";(self.webpackChunkmybase=self.webpackChunkmybase||[]).push([[21681],{47436:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>o,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"\u7801\u519c/\u8ba1\u7b97\u673a\u57fa\u7840/Java \u5bb9\u5668","title":"Java \u5bb9\u5668","description":"* Java \u5bb9\u5668","source":"@site/docs/\u7801\u519c/\u8ba1\u7b97\u673a\u57fa\u7840/Java \u5bb9\u5668.md","sourceDirName":"\u7801\u519c/\u8ba1\u7b97\u673a\u57fa\u7840","slug":"/\u7801\u519c/\u8ba1\u7b97\u673a\u57fa\u7840/Java \u5bb9\u5668","permalink":"/\u7801\u519c/\u8ba1\u7b97\u673a\u57fa\u7840/Java \u5bb9\u5668","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var l=a(74848),s=a(28453);const t={},r="Java \u5bb9\u5668",c={},d=[{value:"\u4e00\u3001\u6982\u89c8",id:"\u4e00\u6982\u89c8",level:2},{value:"Collection",id:"collection",level:3},{value:"1. Set",id:"1-set",level:4},{value:"2. List",id:"2-list",level:4},{value:"3. Queue",id:"3-queue",level:4},{value:"Map",id:"map",level:3},{value:"\u4e8c\u3001\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f",id:"\u4e8c\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f",level:2},{value:"\u8fed\u4ee3\u5668\u6a21\u5f0f",id:"\u8fed\u4ee3\u5668\u6a21\u5f0f",level:3},{value:"\u9002\u914d\u5668\u6a21\u5f0f",id:"\u9002\u914d\u5668\u6a21\u5f0f",level:3},{value:"\u4e09\u3001\u6e90\u7801\u5206\u6790",id:"\u4e09\u6e90\u7801\u5206\u6790",level:2},{value:"ArrayList",id:"arraylist",level:3},{value:"1. \u6982\u89c8",id:"1-\u6982\u89c8",level:4},{value:"2. \u6269\u5bb9",id:"2-\u6269\u5bb9",level:4},{value:"3. \u5220\u9664\u5143\u7d20",id:"3-\u5220\u9664\u5143\u7d20",level:4},{value:"4. \u5e8f\u5217\u5316",id:"4-\u5e8f\u5217\u5316",level:4},{value:"5. Fail-Fast",id:"5-fail-fast",level:4},{value:"Vector",id:"vector",level:3},{value:"1. \u540c\u6b65",id:"1-\u540c\u6b65",level:4},{value:"2. \u6269\u5bb9",id:"2-\u6269\u5bb9-1",level:4},{value:"3. \u4e0e ArrayList \u7684\u6bd4\u8f83",id:"3-\u4e0e-arraylist-\u7684\u6bd4\u8f83",level:4},{value:"4. \u66ff\u4ee3\u65b9\u6848",id:"4-\u66ff\u4ee3\u65b9\u6848",level:4},{value:"CopyOnWriteArrayList",id:"copyonwritearraylist",level:3},{value:"1. \u8bfb\u5199\u5206\u79bb",id:"1-\u8bfb\u5199\u5206\u79bb",level:4},{value:"2. \u9002\u7528\u573a\u666f",id:"2-\u9002\u7528\u573a\u666f",level:4},{value:"LinkedList",id:"linkedlist",level:3},{value:"1. \u6982\u89c8",id:"1-\u6982\u89c8-1",level:4},{value:"2. \u4e0e ArrayList \u7684\u6bd4\u8f83",id:"2-\u4e0e-arraylist-\u7684\u6bd4\u8f83",level:4},{value:"HashMap",id:"hashmap",level:3},{value:"1. \u5b58\u50a8\u7ed3\u6784",id:"1-\u5b58\u50a8\u7ed3\u6784",level:4},{value:"2. \u62c9\u94fe\u6cd5\u7684\u5de5\u4f5c\u539f\u7406",id:"2-\u62c9\u94fe\u6cd5\u7684\u5de5\u4f5c\u539f\u7406",level:4},{value:"3. put \u64cd\u4f5c",id:"3-put-\u64cd\u4f5c",level:4},{value:"4. \u786e\u5b9a\u6876\u4e0b\u6807",id:"4-\u786e\u5b9a\u6876\u4e0b\u6807",level:4},{value:"5. \u6269\u5bb9-\u57fa\u672c\u539f\u7406",id:"5-\u6269\u5bb9-\u57fa\u672c\u539f\u7406",level:4},{value:"6. \u6269\u5bb9-\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807",id:"6-\u6269\u5bb9-\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807",level:4},{value:"7. \u8ba1\u7b97\u6570\u7ec4\u5bb9\u91cf",id:"7-\u8ba1\u7b97\u6570\u7ec4\u5bb9\u91cf",level:4},{value:"8. \u94fe\u8868\u8f6c\u7ea2\u9ed1\u6811",id:"8-\u94fe\u8868\u8f6c\u7ea2\u9ed1\u6811",level:4},{value:"9. \u4e0e Hashtable \u7684\u6bd4\u8f83",id:"9-\u4e0e-hashtable-\u7684\u6bd4\u8f83",level:4},{value:"ConcurrentHashMap",id:"concurrenthashmap",level:3},{value:"1. \u5b58\u50a8\u7ed3\u6784",id:"1-\u5b58\u50a8\u7ed3\u6784-1",level:4},{value:"2. size \u64cd\u4f5c",id:"2-size-\u64cd\u4f5c",level:4},{value:"3. JDK 1.8 \u7684\u6539\u52a8",id:"3-jdk-18-\u7684\u6539\u52a8",level:4},{value:"LinkedHashMap",id:"linkedhashmap",level:3},{value:"\u5b58\u50a8\u7ed3\u6784",id:"\u5b58\u50a8\u7ed3\u6784",level:4},{value:"afterNodeAccess()",id:"afternodeaccess",level:4},{value:"afterNodeInsertion()",id:"afternodeinsertion",level:4},{value:"LRU \u7f13\u5b58",id:"lru-\u7f13\u5b58",level:4},{value:"WeakHashMap",id:"weakhashmap",level:3},{value:"\u5b58\u50a8\u7ed3\u6784",id:"\u5b58\u50a8\u7ed3\u6784-1",level:4},{value:"ConcurrentCache",id:"concurrentcache",level:4},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function h(n){const e={a:"a",br:"br",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"java-\u5bb9\u5668",children:"Java \u5bb9\u5668"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#java-%E5%AE%B9%E5%99%A8",children:"Java \u5bb9\u5668"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#%E4%B8%80%E6%A6%82%E8%A7%88",children:"\u4e00\u3001\u6982\u89c8"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#collection",children:"Collection"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#map",children:"Map"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#%E4%BA%8C%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F",children:"\u4e8c\u3001\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F",children:"\u8fed\u4ee3\u5668\u6a21\u5f0f"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F",children:"\u9002\u914d\u5668\u6a21\u5f0f"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#%E4%B8%89%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90",children:"\u4e09\u3001\u6e90\u7801\u5206\u6790"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#arraylist",children:"ArrayList"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#vector",children:"Vector"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#copyonwritearraylist",children:"CopyOnWriteArrayList"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#linkedlist",children:"LinkedList"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#hashmap",children:"HashMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#concurrenthashmap",children:"ConcurrentHashMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#linkedhashmap",children:"LinkedHashMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#weakhashmap",children:"WeakHashMap"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99",children:"\u53c2\u8003\u8d44\u6599"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u4e00\u6982\u89c8",children:"\u4e00\u3001\u6982\u89c8"}),"\n",(0,l.jsx)(e.p,{children:"\u5bb9\u5668\u4e3b\u8981\u5305\u62ec Collection \u548c Map \u4e24\u79cd\uff0cCollection \u5b58\u50a8\u7740\u5bf9\u8c61\u7684\u96c6\u5408\uff0c\u800c Map \u5b58\u50a8\u7740\u952e\u503c\u5bf9\uff08\u4e24\u4e2a\u5bf9\u8c61\uff09\u7684\u6620\u5c04\u8868\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"collection",children:"Collection"}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208220948084.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.h4,{id:"1-set",children:"1. Set"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"TreeSet\uff1a\u57fa\u4e8e\u7ea2\u9ed1\u6811\u5b9e\u73b0\uff0c\u652f\u6301\u6709\u5e8f\u6027\u64cd\u4f5c\uff0c\u4f8b\u5982\u6839\u636e\u4e00\u4e2a\u8303\u56f4\u67e5\u627e\u5143\u7d20\u7684\u64cd\u4f5c\u3002\u4f46\u662f\u67e5\u627e\u6548\u7387\u4e0d\u5982 HashSet\uff0cHashSet \u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0cTreeSet \u5219\u4e3a O(logN)\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"HashSet\uff1a\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\uff0c\u652f\u6301\u5feb\u901f\u67e5\u627e\uff0c\u4f46\u4e0d\u652f\u6301\u6709\u5e8f\u6027\u64cd\u4f5c\u3002\u5e76\u4e14\u5931\u53bb\u4e86\u5143\u7d20\u7684\u63d2\u5165\u987a\u5e8f\u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f7f\u7528 Iterator \u904d\u5386 HashSet \u5f97\u5230\u7684\u7ed3\u679c\u662f\u4e0d\u786e\u5b9a\u7684\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"LinkedHashSet\uff1a\u5177\u6709 HashSet \u7684\u67e5\u627e\u6548\u7387\uff0c\u5e76\u4e14\u5185\u90e8\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u7ef4\u62a4\u5143\u7d20\u7684\u63d2\u5165\u987a\u5e8f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"2-list",children:"2. List"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"ArrayList\uff1a\u57fa\u4e8e\u52a8\u6001\u6570\u7ec4\u5b9e\u73b0\uff0c\u652f\u6301\u968f\u673a\u8bbf\u95ee\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"Vector\uff1a\u548c ArrayList \u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"LinkedList\uff1a\u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\uff0c\u53ea\u80fd\u987a\u5e8f\u8bbf\u95ee\uff0c\u4f46\u662f\u53ef\u4ee5\u5feb\u901f\u5730\u5728\u94fe\u8868\u4e2d\u95f4\u63d2\u5165\u548c\u5220\u9664\u5143\u7d20\u3002\u4e0d\u4ec5\u5982\u6b64\uff0cLinkedList \u8fd8\u53ef\u4ee5\u7528\u4f5c\u6808\u3001\u961f\u5217\u548c\u53cc\u5411\u961f\u5217\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"3-queue",children:"3. Queue"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"LinkedList\uff1a\u53ef\u4ee5\u7528\u5b83\u6765\u5b9e\u73b0\u53cc\u5411\u961f\u5217\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"PriorityQueue\uff1a\u57fa\u4e8e\u5806\u7ed3\u6784\u5b9e\u73b0\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u5b9e\u73b0\u4f18\u5148\u961f\u5217\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"map",children:"Map"}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20201101234335837.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"TreeMap\uff1a\u57fa\u4e8e\u7ea2\u9ed1\u6811\u5b9e\u73b0\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"HashMap\uff1a\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"HashTable\uff1a\u548c HashMap \u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u8fd9\u610f\u5473\u7740\u540c\u4e00\u65f6\u523b\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5199\u5165 HashTable \u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u3002\u5b83\u662f\u9057\u7559\u7c7b\uff0c\u4e0d\u5e94\u8be5\u53bb\u4f7f\u7528\u5b83\uff0c\u800c\u662f\u4f7f\u7528 ConcurrentHashMap \u6765\u652f\u6301\u7ebf\u7a0b\u5b89\u5168\uff0cConcurrentHashMap \u7684\u6548\u7387\u4f1a\u66f4\u9ad8\uff0c\u56e0\u4e3a ConcurrentHashMap \u5f15\u5165\u4e86\u5206\u6bb5\u9501\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"LinkedHashMap\uff1a\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u6765\u7ef4\u62a4\u5143\u7d20\u7684\u987a\u5e8f\uff0c\u987a\u5e8f\u4e3a\u63d2\u5165\u987a\u5e8f\u6216\u8005\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff08LRU\uff09\u987a\u5e8f\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"\u4e8c\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f",children:"\u4e8c\u3001\u5bb9\u5668\u4e2d\u7684\u8bbe\u8ba1\u6a21\u5f0f"}),"\n",(0,l.jsx)(e.h3,{id:"\u8fed\u4ee3\u5668\u6a21\u5f0f",children:"\u8fed\u4ee3\u5668\u6a21\u5f0f"}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208225301973.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.p,{children:"Collection \u7ee7\u627f\u4e86 Iterable \u63a5\u53e3\uff0c\u5176\u4e2d\u7684 iterator() \u65b9\u6cd5\u80fd\u591f\u4ea7\u751f\u4e00\u4e2a Iterator \u5bf9\u8c61\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5bf9\u8c61\u5c31\u53ef\u4ee5\u8fed\u4ee3\u904d\u5386 Collection \u4e2d\u7684\u5143\u7d20\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4ece JDK 1.5 \u4e4b\u540e\u53ef\u4ee5\u4f7f\u7528 foreach \u65b9\u6cd5\u6765\u904d\u5386\u5b9e\u73b0\u4e86 Iterable \u63a5\u53e3\u7684\u805a\u5408\u5bf9\u8c61\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'List<String> list = new ArrayList<>();\nlist.add("a");\nlist.add("b");\nfor (String item : list) {\n    System.out.println(item);\n}\n'})}),"\n",(0,l.jsx)(e.h3,{id:"\u9002\u914d\u5668\u6a21\u5f0f",children:"\u9002\u914d\u5668\u6a21\u5f0f"}),"\n",(0,l.jsx)(e.p,{children:"java.util.Arrays#asList() \u53ef\u4ee5\u628a\u6570\u7ec4\u7c7b\u578b\u8f6c\u6362\u4e3a List \u7c7b\u578b\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"@SafeVarargs\npublic static <T> List<T> asList(T... a)\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5e94\u8be5\u6ce8\u610f\u7684\u662f asList() \u7684\u53c2\u6570\u4e3a\u6cdb\u578b\u7684\u53d8\u957f\u53c2\u6570\uff0c\u4e0d\u80fd\u4f7f\u7528\u57fa\u672c\u7c7b\u578b\u6570\u7ec4\u4f5c\u4e3a\u53c2\u6570\uff0c\u53ea\u80fd\u4f7f\u7528\u76f8\u5e94\u7684\u5305\u88c5\u7c7b\u578b\u6570\u7ec4\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Integer[] arr = {1, 2, 3};\nList list = Arrays.asList(arr);\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u8c03\u7528 asList()\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"List list = Arrays.asList(1, 2, 3);\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u4e09\u6e90\u7801\u5206\u6790",children:"\u4e09\u3001\u6e90\u7801\u5206\u6790"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u679c\u6ca1\u6709\u7279\u522b\u8bf4\u660e\uff0c\u4ee5\u4e0b\u6e90\u7801\u5206\u6790\u57fa\u4e8e JDK 1.8\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5728 IDEA \u4e2d double shift \u8c03\u51fa Search EveryWhere\uff0c\u67e5\u627e\u6e90\u7801\u6587\u4ef6\uff0c\u627e\u5230\u4e4b\u540e\u5c31\u53ef\u4ee5\u9605\u8bfb\u6e90\u7801\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"arraylist",children:"ArrayList"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u6982\u89c8",children:"1. \u6982\u89c8"}),"\n",(0,l.jsx)(e.p,{children:"\u56e0\u4e3a ArrayList \u662f\u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u652f\u6301\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002RandomAccess \u63a5\u53e3\u6807\u8bc6\u7740\u8be5\u7c7b\u652f\u6301\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public class ArrayList<E> extends AbstractList<E>\n        implements List<E>, RandomAccess, Cloneable, java.io.Serializable\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6570\u7ec4\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 10\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private static final int DEFAULT_CAPACITY = 10;\n"})}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208232221265.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.h4,{id:"2-\u6269\u5bb9",children:"2. \u6269\u5bb9"}),"\n",(0,l.jsxs)(e.p,{children:["\u6dfb\u52a0\u5143\u7d20\u65f6\u4f7f\u7528 ensureCapacityInternal() \u65b9\u6cd5\u6765\u4fdd\u8bc1\u5bb9\u91cf\u8db3\u591f\uff0c\u5982\u679c\u4e0d\u591f\u65f6\uff0c\u9700\u8981\u4f7f\u7528 grow() \u65b9\u6cd5\u8fdb\u884c\u6269\u5bb9\uff0c\u65b0\u5bb9\u91cf\u7684\u5927\u5c0f\u4e3a ",(0,l.jsx)(e.code,{children:"oldCapacity + (oldCapacity >> 1)"}),"\uff0c\u5373 oldCapacity+oldCapacity/2\u3002\u5176\u4e2d oldCapacity >> 1 \u9700\u8981\u53d6\u6574\uff0c\u6240\u4ee5\u65b0\u5bb9\u91cf\u5927\u7ea6\u662f\u65e7\u5bb9\u91cf\u7684 1.5 \u500d\u5de6\u53f3\u3002\uff08oldCapacity \u4e3a\u5076\u6570\u5c31\u662f 1.5 \u500d\uff0c\u4e3a\u5947\u6570\u5c31\u662f 1.5 \u500d-0.5\uff09"]}),"\n",(0,l.jsxs)(e.p,{children:["\u6269\u5bb9\u64cd\u4f5c\u9700\u8981\u8c03\u7528 ",(0,l.jsx)(e.code,{children:"Arrays.copyOf()"})," \u628a\u539f\u6570\u7ec4\u6574\u4e2a\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u56e0\u6b64\u6700\u597d\u5728\u521b\u5efa ArrayList \u5bf9\u8c61\u65f6\u5c31\u6307\u5b9a\u5927\u6982\u7684\u5bb9\u91cf\u5927\u5c0f\uff0c\u51cf\u5c11\u6269\u5bb9\u64cd\u4f5c\u7684\u6b21\u6570\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public boolean add(E e) {\n    ensureCapacityInternal(size + 1);  // Increments modCount!!\n    elementData[size++] = e;\n    return true;\n}\n\nprivate void ensureCapacityInternal(int minCapacity) {\n    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\n        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n    }\n    ensureExplicitCapacity(minCapacity);\n}\n\nprivate void ensureExplicitCapacity(int minCapacity) {\n    modCount++;\n    // overflow-conscious code\n    if (minCapacity - elementData.length > 0)\n        grow(minCapacity);\n}\n\nprivate void grow(int minCapacity) {\n    // overflow-conscious code\n    int oldCapacity = elementData.length;\n    int newCapacity = oldCapacity + (oldCapacity >> 1);\n    if (newCapacity - minCapacity < 0)\n        newCapacity = minCapacity;\n    if (newCapacity - MAX_ARRAY_SIZE > 0)\n        newCapacity = hugeCapacity(minCapacity);\n    // minCapacity is usually close to size, so this is a win:\n    elementData = Arrays.copyOf(elementData, newCapacity);\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"3-\u5220\u9664\u5143\u7d20",children:"3. \u5220\u9664\u5143\u7d20"}),"\n",(0,l.jsx)(e.p,{children:"\u9700\u8981\u8c03\u7528 System.arraycopy() \u5c06 index+1 \u540e\u9762\u7684\u5143\u7d20\u90fd\u590d\u5236\u5230 index \u4f4d\u7f6e\u4e0a\uff0c\u8be5\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(N)\uff0c\u53ef\u4ee5\u770b\u5230 ArrayList \u5220\u9664\u5143\u7d20\u7684\u4ee3\u4ef7\u662f\u975e\u5e38\u9ad8\u7684\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public E remove(int index) {\n    rangeCheck(index);\n    modCount++;\n    E oldValue = elementData(index);\n    int numMoved = size - index - 1;\n    if (numMoved > 0)\n        System.arraycopy(elementData, index+1, elementData, index, numMoved);\n    elementData[--size] = null; // clear to let GC do its work\n    return oldValue;\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"4-\u5e8f\u5217\u5316",children:"4. \u5e8f\u5217\u5316"}),"\n",(0,l.jsx)(e.p,{children:"ArrayList \u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\uff0c\u5e76\u4e14\u5177\u6709\u52a8\u6001\u6269\u5bb9\u7279\u6027\uff0c\u56e0\u6b64\u4fdd\u5b58\u5143\u7d20\u7684\u6570\u7ec4\u4e0d\u4e00\u5b9a\u90fd\u4f1a\u88ab\u4f7f\u7528\uff0c\u90a3\u4e48\u5c31\u6ca1\u5fc5\u8981\u5168\u90e8\u8fdb\u884c\u5e8f\u5217\u5316\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4fdd\u5b58\u5143\u7d20\u7684\u6570\u7ec4 elementData \u4f7f\u7528 transient \u4fee\u9970\uff0c\u8be5\u5173\u952e\u5b57\u58f0\u660e\u6570\u7ec4\u9ed8\u8ba4\u4e0d\u4f1a\u88ab\u5e8f\u5217\u5316\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"transient Object[] elementData; // non-private to simplify nested class access\n"})}),"\n",(0,l.jsx)(e.p,{children:"ArrayList \u5b9e\u73b0\u4e86 writeObject() \u548c readObject() \u6765\u63a7\u5236\u53ea\u5e8f\u5217\u5316\u6570\u7ec4\u4e2d\u6709\u5143\u7d20\u586b\u5145\u90a3\u90e8\u5206\u5185\u5bb9\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private void readObject(java.io.ObjectInputStream s)\n    throws java.io.IOException, ClassNotFoundException {\n    elementData = EMPTY_ELEMENTDATA;\n\n    // Read in size, and any hidden stuff\n    s.defaultReadObject();\n\n    // Read in capacity\n    s.readInt(); // ignored\n\n    if (size > 0) {\n        // be like clone(), allocate array based upon size not capacity\n        ensureCapacityInternal(size);\n\n        Object[] a = elementData;\n        // Read in all elements in the proper order.\n        for (int i=0; i<size; i++) {\n            a[i] = s.readObject();\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private void writeObject(java.io.ObjectOutputStream s)\n    throws java.io.IOException{\n    // Write out element count, and any hidden stuff\n    int expectedModCount = modCount;\n    s.defaultWriteObject();\n\n    // Write out size as capacity for behavioural compatibility with clone()\n    s.writeInt(size);\n\n    // Write out all elements in the proper order.\n    for (int i=0; i<size; i++) {\n        s.writeObject(elementData[i]);\n    }\n\n    if (modCount != expectedModCount) {\n        throw new ConcurrentModificationException();\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5e8f\u5217\u5316\u65f6\u9700\u8981\u4f7f\u7528 ObjectOutputStream \u7684 writeObject() \u5c06\u5bf9\u8c61\u8f6c\u6362\u4e3a\u5b57\u8282\u6d41\u5e76\u8f93\u51fa\u3002\u800c writeObject() \u65b9\u6cd5\u5728\u4f20\u5165\u7684\u5bf9\u8c61\u5b58\u5728 writeObject() \u7684\u65f6\u5019\u4f1a\u53bb\u53cd\u5c04\u8c03\u7528\u8be5\u5bf9\u8c61\u7684 writeObject() \u6765\u5b9e\u73b0\u5e8f\u5217\u5316\u3002\u53cd\u5e8f\u5217\u5316\u4f7f\u7528\u7684\u662f ObjectInputStream \u7684 readObject() \u65b9\u6cd5\uff0c\u539f\u7406\u7c7b\u4f3c\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"ArrayList list = new ArrayList();\nObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(file));\noos.writeObject(list);\n"})}),"\n",(0,l.jsx)(e.h4,{id:"5-fail-fast",children:"5. Fail-Fast"}),"\n",(0,l.jsx)(e.p,{children:"modCount \u7528\u6765\u8bb0\u5f55 ArrayList \u7ed3\u6784\u53d1\u751f\u53d8\u5316\u7684\u6b21\u6570\u3002\u7ed3\u6784\u53d1\u751f\u53d8\u5316\u662f\u6307\u6dfb\u52a0\u6216\u8005\u5220\u9664\u81f3\u5c11\u4e00\u4e2a\u5143\u7d20\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u6216\u8005\u662f\u8c03\u6574\u5185\u90e8\u6570\u7ec4\u7684\u5927\u5c0f\uff0c\u4ec5\u4ec5\u53ea\u662f\u8bbe\u7f6e\u5143\u7d20\u7684\u503c\u4e0d\u7b97\u7ed3\u6784\u53d1\u751f\u53d8\u5316\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u8fdb\u884c\u5e8f\u5217\u5316\u6216\u8005\u8fed\u4ee3\u7b49\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u6bd4\u8f83\u64cd\u4f5c\u524d\u540e modCount \u662f\u5426\u6539\u53d8\uff0c\u5982\u679c\u6539\u53d8\u4e86\u9700\u8981\u629b\u51fa ConcurrentModificationException\u3002\u4ee3\u7801\u53c2\u8003\u4e0a\u8282\u5e8f\u5217\u5316\u4e2d\u7684 writeObject() \u65b9\u6cd5\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"vector",children:"Vector"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u540c\u6b65",children:"1. \u540c\u6b65"}),"\n",(0,l.jsx)(e.p,{children:"\u5b83\u7684\u5b9e\u73b0\u4e0e ArrayList \u7c7b\u4f3c\uff0c\u4f46\u662f\u4f7f\u7528\u4e86 synchronized \u8fdb\u884c\u540c\u6b65\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public synchronized boolean add(E e) {\n    modCount++;\n    ensureCapacityHelper(elementCount + 1);\n    elementData[elementCount++] = e;\n    return true;\n}\n\npublic synchronized E get(int index) {\n    if (index >= elementCount)\n        throw new ArrayIndexOutOfBoundsException(index);\n\n    return elementData(index);\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"2-\u6269\u5bb9-1",children:"2. \u6269\u5bb9"}),"\n",(0,l.jsx)(e.p,{children:"Vector \u7684\u6784\u9020\u51fd\u6570\u53ef\u4ee5\u4f20\u5165 capacityIncrement \u53c2\u6570\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5728\u6269\u5bb9\u65f6\u4f7f\u5bb9\u91cf capacity \u589e\u957f capacityIncrement\u3002\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\u5c0f\u4e8e\u7b49\u4e8e 0\uff0c\u6269\u5bb9\u65f6\u6bcf\u6b21\u90fd\u4ee4 capacity \u4e3a\u539f\u6765\u7684\u4e24\u500d\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'public Vector(int initialCapacity, int capacityIncrement) {\n    super();\n    if (initialCapacity < 0)\n        throw new IllegalArgumentException("Illegal Capacity: "+\n                                           initialCapacity);\n    this.elementData = new Object[initialCapacity];\n    this.capacityIncrement = capacityIncrement;\n}\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private void grow(int minCapacity) {\n    // overflow-conscious code\n    int oldCapacity = elementData.length;\n    int newCapacity = oldCapacity + ((capacityIncrement > 0) ?\n                                     capacityIncrement : oldCapacity);\n    if (newCapacity - minCapacity < 0)\n        newCapacity = minCapacity;\n    if (newCapacity - MAX_ARRAY_SIZE > 0)\n        newCapacity = hugeCapacity(minCapacity);\n    elementData = Arrays.copyOf(elementData, newCapacity);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u8c03\u7528\u6ca1\u6709 capacityIncrement \u7684\u6784\u9020\u51fd\u6570\u65f6\uff0ccapacityIncrement \u503c\u88ab\u8bbe\u7f6e\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u8bf4\u9ed8\u8ba4\u60c5\u51b5\u4e0b Vector \u6bcf\u6b21\u6269\u5bb9\u65f6\u5bb9\u91cf\u90fd\u4f1a\u7ffb\u500d\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public Vector(int initialCapacity) {\n    this(initialCapacity, 0);\n}\n\npublic Vector() {\n    this(10);\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"3-\u4e0e-arraylist-\u7684\u6bd4\u8f83",children:"3. \u4e0e ArrayList \u7684\u6bd4\u8f83"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Vector \u662f\u540c\u6b65\u7684\uff0c\u56e0\u6b64\u5f00\u9500\u5c31\u6bd4 ArrayList \u8981\u5927\uff0c\u8bbf\u95ee\u901f\u5ea6\u66f4\u6162\u3002\u6700\u597d\u4f7f\u7528 ArrayList \u800c\u4e0d\u662f Vector\uff0c\u56e0\u4e3a\u540c\u6b65\u64cd\u4f5c\u5b8c\u5168\u53ef\u4ee5\u7531\u7a0b\u5e8f\u5458\u81ea\u5df1\u6765\u63a7\u5236\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"Vector \u6bcf\u6b21\u6269\u5bb9\u8bf7\u6c42\u5176\u5927\u5c0f\u7684 2 \u500d\uff08\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8bbe\u7f6e\u589e\u957f\u7684\u5bb9\u91cf\uff09\uff0c\u800c ArrayList \u662f 1.5 \u500d\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"4-\u66ff\u4ee3\u65b9\u6848",children:"4. \u66ff\u4ee3\u65b9\u6848"}),"\n",(0,l.jsxs)(e.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"Collections.synchronizedList();"})," \u5f97\u5230\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684 ArrayList\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"List<String> list = new ArrayList<>();\nList<String> synList = Collections.synchronizedList(list);\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u4f7f\u7528 concurrent \u5e76\u53d1\u5305\u4e0b\u7684 CopyOnWriteArrayList \u7c7b\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"List<String> list = new CopyOnWriteArrayList<>();\n"})}),"\n",(0,l.jsx)(e.h3,{id:"copyonwritearraylist",children:"CopyOnWriteArrayList"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u8bfb\u5199\u5206\u79bb",children:"1. \u8bfb\u5199\u5206\u79bb"}),"\n",(0,l.jsx)(e.p,{children:"\u5199\u64cd\u4f5c\u5728\u4e00\u4e2a\u590d\u5236\u7684\u6570\u7ec4\u4e0a\u8fdb\u884c\uff0c\u8bfb\u64cd\u4f5c\u8fd8\u662f\u5728\u539f\u59cb\u6570\u7ec4\u4e2d\u8fdb\u884c\uff0c\u8bfb\u5199\u5206\u79bb\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5199\u64cd\u4f5c\u9700\u8981\u52a0\u9501\uff0c\u9632\u6b62\u5e76\u53d1\u5199\u5165\u65f6\u5bfc\u81f4\u5199\u5165\u6570\u636e\u4e22\u5931\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5199\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e\u9700\u8981\u628a\u539f\u59cb\u6570\u7ec4\u6307\u5411\u65b0\u7684\u590d\u5236\u6570\u7ec4\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public boolean add(E e) {\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        Object[] elements = getArray();\n        int len = elements.length;\n        Object[] newElements = Arrays.copyOf(elements, len + 1);\n        newElements[len] = e;\n        setArray(newElements);\n        return true;\n    } finally {\n        lock.unlock();\n    }\n}\n\nfinal void setArray(Object[] a) {\n    array = a;\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'@SuppressWarnings("unchecked")\nprivate E get(Object[] a, int index) {\n    return (E) a[index];\n}\n'})}),"\n",(0,l.jsx)(e.h4,{id:"2-\u9002\u7528\u573a\u666f",children:"2. \u9002\u7528\u573a\u666f"}),"\n",(0,l.jsx)(e.p,{children:"CopyOnWriteArrayList \u5728\u5199\u64cd\u4f5c\u7684\u540c\u65f6\u5141\u8bb8\u8bfb\u64cd\u4f5c\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u8bfb\u64cd\u4f5c\u7684\u6027\u80fd\uff0c\u56e0\u6b64\u5f88\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u5e94\u7528\u573a\u666f\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4f46\u662f CopyOnWriteArrayList \u6709\u5176\u7f3a\u9677\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5185\u5b58\u5360\u7528\uff1a\u5728\u5199\u64cd\u4f5c\u65f6\u9700\u8981\u590d\u5236\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\uff0c\u4f7f\u5f97\u5185\u5b58\u5360\u7528\u4e3a\u539f\u6765\u7684\u4e24\u500d\u5de6\u53f3\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u6570\u636e\u4e0d\u4e00\u81f4\uff1a\u8bfb\u64cd\u4f5c\u4e0d\u80fd\u8bfb\u53d6\u5b9e\u65f6\u6027\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u90e8\u5206\u5199\u64cd\u4f5c\u7684\u6570\u636e\u8fd8\u672a\u540c\u6b65\u5230\u8bfb\u6570\u7ec4\u4e2d\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u6240\u4ee5 CopyOnWriteArrayList \u4e0d\u9002\u5408\u5185\u5b58\u654f\u611f\u4ee5\u53ca\u5bf9\u5b9e\u65f6\u6027\u8981\u6c42\u5f88\u9ad8\u7684\u573a\u666f\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"linkedlist",children:"LinkedList"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u6982\u89c8-1",children:"1. \u6982\u89c8"}),"\n",(0,l.jsx)(e.p,{children:"\u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\uff0c\u4f7f\u7528 Node \u5b58\u50a8\u94fe\u8868\u8282\u70b9\u4fe1\u606f\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private static class Node<E> {\n    E item;\n    Node<E> next;\n    Node<E> prev;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6bcf\u4e2a\u94fe\u8868\u5b58\u50a8\u4e86 first \u548c last \u6307\u9488\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"transient Node<E> first;\ntransient Node<E> last;\n"})}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208233940066.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.h4,{id:"2-\u4e0e-arraylist-\u7684\u6bd4\u8f83",children:"2. \u4e0e ArrayList \u7684\u6bd4\u8f83"}),"\n",(0,l.jsx)(e.p,{children:"ArrayList \u57fa\u4e8e\u52a8\u6001\u6570\u7ec4\u5b9e\u73b0\uff0cLinkedList \u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\u3002ArrayList \u548c LinkedList \u7684\u533a\u522b\u53ef\u4ee5\u5f52\u7ed3\u4e3a\u6570\u7ec4\u548c\u94fe\u8868\u7684\u533a\u522b\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6570\u7ec4\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u4f46\u63d2\u5165\u5220\u9664\u7684\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u9700\u8981\u79fb\u52a8\u5927\u91cf\u5143\u7d20\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u94fe\u8868\u4e0d\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff0c\u4f46\u63d2\u5165\u5220\u9664\u53ea\u9700\u8981\u6539\u53d8\u6307\u9488\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"hashmap",children:"HashMap"}),"\n",(0,l.jsx)(e.p,{children:"\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u4ee5\u4e0b\u6e90\u7801\u5206\u6790\u4ee5 JDK 1.7 \u4e3a\u4e3b\u3002"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u5b58\u50a8\u7ed3\u6784",children:"1. \u5b58\u50a8\u7ed3\u6784"}),"\n",(0,l.jsx)(e.p,{children:"\u5185\u90e8\u5305\u542b\u4e86\u4e00\u4e2a Entry \u7c7b\u578b\u7684\u6570\u7ec4 table\u3002Entry \u5b58\u50a8\u7740\u952e\u503c\u5bf9\u3002\u5b83\u5305\u542b\u4e86\u56db\u4e2a\u5b57\u6bb5\uff0c\u4ece next \u5b57\u6bb5\u6211\u4eec\u53ef\u4ee5\u770b\u51fa Entry \u662f\u4e00\u4e2a\u94fe\u8868\u3002\u5373\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u4f4d\u7f6e\u88ab\u5f53\u6210\u4e00\u4e2a\u6876\uff0c\u4e00\u4e2a\u6876\u5b58\u653e\u4e00\u4e2a\u94fe\u8868\u3002HashMap \u4f7f\u7528\u62c9\u94fe\u6cd5\u6765\u89e3\u51b3\u51b2\u7a81\uff0c\u540c\u4e00\u4e2a\u94fe\u8868\u4e2d\u5b58\u653e\u54c8\u5e0c\u503c\u548c\u6563\u5217\u6876\u53d6\u6a21\u8fd0\u7b97\u7ed3\u679c\u76f8\u540c\u7684 Entry\u3002"}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208234948205.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"transient Entry[] table;\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'static class Entry<K,V> implements Map.Entry<K,V> {\n    final K key;\n    V value;\n    Entry<K,V> next;\n    int hash;\n\n    Entry(int h, K k, V v, Entry<K,V> n) {\n        value = v;\n        next = n;\n        key = k;\n        hash = h;\n    }\n\n    public final K getKey() {\n        return key;\n    }\n\n    public final V getValue() {\n        return value;\n    }\n\n    public final V setValue(V newValue) {\n        V oldValue = value;\n        value = newValue;\n        return oldValue;\n    }\n\n    public final boolean equals(Object o) {\n        if (!(o instanceof Map.Entry))\n            return false;\n        Map.Entry e = (Map.Entry)o;\n        Object k1 = getKey();\n        Object k2 = e.getKey();\n        if (k1 == k2 || (k1 != null && k1.equals(k2))) {\n            Object v1 = getValue();\n            Object v2 = e.getValue();\n            if (v1 == v2 || (v1 != null && v1.equals(v2)))\n                return true;\n        }\n        return false;\n    }\n\n    public final int hashCode() {\n        return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());\n    }\n\n    public final String toString() {\n        return getKey() + "=" + getValue();\n    }\n}\n'})}),"\n",(0,l.jsx)(e.h4,{id:"2-\u62c9\u94fe\u6cd5\u7684\u5de5\u4f5c\u539f\u7406",children:"2. \u62c9\u94fe\u6cd5\u7684\u5de5\u4f5c\u539f\u7406"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'HashMap<String, String> map = new HashMap<>();\nmap.put("K1", "V1");\nmap.put("K2", "V2");\nmap.put("K3", "V3");\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u65b0\u5efa\u4e00\u4e2a HashMap\uff0c\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u63d2\u5165 <K1,V1> \u952e\u503c\u5bf9\uff0c\u5148\u8ba1\u7b97 K1 \u7684 hashCode \u4e3a 115\uff0c\u4f7f\u7528\u9664\u7559\u4f59\u6570\u6cd5\u5f97\u5230\u6240\u5728\u7684\u6876\u4e0b\u6807 115%16=3\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u63d2\u5165 <K2,V2> \u952e\u503c\u5bf9\uff0c\u5148\u8ba1\u7b97 K2 \u7684 hashCode \u4e3a 118\uff0c\u4f7f\u7528\u9664\u7559\u4f59\u6570\u6cd5\u5f97\u5230\u6240\u5728\u7684\u6876\u4e0b\u6807 118%16=6\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u63d2\u5165 <K3,V3> \u952e\u503c\u5bf9\uff0c\u5148\u8ba1\u7b97 K3 \u7684 hashCode \u4e3a 118\uff0c\u4f7f\u7528\u9664\u7559\u4f59\u6570\u6cd5\u5f97\u5230\u6240\u5728\u7684\u6876\u4e0b\u6807 118%16=6\uff0c\u63d2\u5728 <K2,V2> \u524d\u9762\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u5e94\u8be5\u6ce8\u610f\u5230\u94fe\u8868\u7684\u63d2\u5165\u662f\u4ee5\u5934\u63d2\u6cd5\u65b9\u5f0f\u8fdb\u884c\u7684\uff0c\u4f8b\u5982\u4e0a\u9762\u7684 <K3,V3> \u4e0d\u662f\u63d2\u5728 <K2,V2> \u540e\u9762\uff0c\u800c\u662f\u63d2\u5165\u5728\u94fe\u8868\u5934\u90e8\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u67e5\u627e\u9700\u8981\u5206\u6210\u4e24\u6b65\u8fdb\u884c\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8ba1\u7b97\u952e\u503c\u5bf9\u6240\u5728\u7684\u6876\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u5728\u94fe\u8868\u4e0a\u987a\u5e8f\u67e5\u627e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u663e\u7136\u548c\u94fe\u8868\u7684\u957f\u5ea6\u6210\u6b63\u6bd4\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191208235258643.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.h4,{id:"3-put-\u64cd\u4f5c",children:"3. put \u64cd\u4f5c"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public V put(K key, V value) {\n    if (table == EMPTY_TABLE) {\n        inflateTable(threshold);\n    }\n    // \u952e\u4e3a null \u5355\u72ec\u5904\u7406\n    if (key == null)\n        return putForNullKey(value);\n    int hash = hash(key);\n    // \u786e\u5b9a\u6876\u4e0b\u6807\n    int i = indexFor(hash, table.length);\n    // \u5148\u627e\u51fa\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u952e\u4e3a key \u7684\u952e\u503c\u5bf9\uff0c\u5982\u679c\u5b58\u5728\u7684\u8bdd\u5c31\u66f4\u65b0\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u503c\u4e3a value\n    for (Entry<K,V> e = table[i]; e != null; e = e.next) {\n        Object k;\n        if (e.hash == hash && ((k = e.key) == key || key.equals(k))) {\n            V oldValue = e.value;\n            e.value = value;\n            e.recordAccess(this);\n            return oldValue;\n        }\n    }\n\n    modCount++;\n    // \u63d2\u5165\u65b0\u952e\u503c\u5bf9\n    addEntry(hash, key, value, i);\n    return null;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"HashMap \u5141\u8bb8\u63d2\u5165\u952e\u4e3a null \u7684\u952e\u503c\u5bf9\u3002\u4f46\u662f\u56e0\u4e3a\u65e0\u6cd5\u8c03\u7528 null \u7684 hashCode() \u65b9\u6cd5\uff0c\u4e5f\u5c31\u65e0\u6cd5\u786e\u5b9a\u8be5\u952e\u503c\u5bf9\u7684\u6876\u4e0b\u6807\uff0c\u53ea\u80fd\u901a\u8fc7\u5f3a\u5236\u6307\u5b9a\u4e00\u4e2a\u6876\u4e0b\u6807\u6765\u5b58\u653e\u3002HashMap \u4f7f\u7528\u7b2c 0 \u4e2a\u6876\u5b58\u653e\u952e\u4e3a null \u7684\u952e\u503c\u5bf9\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private V putForNullKey(V value) {\n    for (Entry<K,V> e = table[0]; e != null; e = e.next) {\n        if (e.key == null) {\n            V oldValue = e.value;\n            e.value = value;\n            e.recordAccess(this);\n            return oldValue;\n        }\n    }\n    modCount++;\n    addEntry(0, null, value, 0);\n    return null;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4f7f\u7528\u94fe\u8868\u7684\u5934\u63d2\u6cd5\uff0c\u4e5f\u5c31\u662f\u65b0\u7684\u952e\u503c\u5bf9\u63d2\u5728\u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c\u4e0d\u662f\u94fe\u8868\u7684\u5c3e\u90e8\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void addEntry(int hash, K key, V value, int bucketIndex) {\n    if ((size >= threshold) && (null != table[bucketIndex])) {\n        resize(2 * table.length);\n        hash = (null != key) ? hash(key) : 0;\n        bucketIndex = indexFor(hash, table.length);\n    }\n\n    createEntry(hash, key, value, bucketIndex);\n}\n\nvoid createEntry(int hash, K key, V value, int bucketIndex) {\n    Entry<K,V> e = table[bucketIndex];\n    // \u5934\u63d2\u6cd5\uff0c\u94fe\u8868\u5934\u90e8\u6307\u5411\u65b0\u7684\u952e\u503c\u5bf9\n    table[bucketIndex] = new Entry<>(hash, key, value, e);\n    size++;\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"Entry(int h, K k, V v, Entry<K,V> n) {\n    value = v;\n    next = n;\n    key = k;\n    hash = h;\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"4-\u786e\u5b9a\u6876\u4e0b\u6807",children:"4. \u786e\u5b9a\u6876\u4e0b\u6807"}),"\n",(0,l.jsx)(e.p,{children:"\u5f88\u591a\u64cd\u4f5c\u90fd\u9700\u8981\u5148\u786e\u5b9a\u4e00\u4e2a\u952e\u503c\u5bf9\u6240\u5728\u7684\u6876\u4e0b\u6807\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"int hash = hash(key);\nint i = indexFor(hash, table.length);\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4.1 \u8ba1\u7b97 hash \u503c"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"final int hash(Object k) {\n    int h = hashSeed;\n    if (0 != h && k instanceof String) {\n        return sun.misc.Hashing.stringHash32((String) k);\n    }\n\n    h ^= k.hashCode();\n\n    // This function ensures that hashCodes that differ only by\n    // constant multiples at each bit position have a bounded\n    // number of collisions (approximately 8 at default load factor).\n    h ^= (h >>> 20) ^ (h >>> 12);\n    return h ^ (h >>> 7) ^ (h >>> 4);\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public final int hashCode() {\n    return Objects.hashCode(key) ^ Objects.hashCode(value);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"4.2 \u53d6\u6a21"})}),"\n",(0,l.jsx)(e.p,{children:"\u4ee4 x = 1<<4\uff0c\u5373 x \u4e3a 2 \u7684 4 \u6b21\u65b9\uff0c\u5b83\u5177\u6709\u4ee5\u4e0b\u6027\u8d28\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"x   : 00010000\nx-1 : 00001111\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4ee4\u4e00\u4e2a\u6570 y \u4e0e x-1 \u505a\u4e0e\u8fd0\u7b97\uff0c\u53ef\u4ee5\u53bb\u9664 y \u4f4d\u7ea7\u8868\u793a\u7684\u7b2c 4 \u4f4d\u4ee5\u4e0a\u6570\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"y       : 10110010\nx-1     : 00001111\ny&(x-1) : 00000010\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u8fd9\u4e2a\u6027\u8d28\u548c y \u5bf9 x \u53d6\u6a21\u6548\u679c\u662f\u4e00\u6837\u7684\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"y   : 10110010\nx   : 00010000\ny%x : 00000010\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6211\u4eec\u77e5\u9053\uff0c\u4f4d\u8fd0\u7b97\u7684\u4ee3\u4ef7\u6bd4\u6c42\u6a21\u8fd0\u7b97\u5c0f\u7684\u591a\uff0c\u56e0\u6b64\u5728\u8fdb\u884c\u8fd9\u79cd\u8ba1\u7b97\u65f6\u7528\u4f4d\u8fd0\u7b97\u7684\u8bdd\u80fd\u5e26\u6765\u66f4\u9ad8\u7684\u6027\u80fd\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u786e\u5b9a\u6876\u4e0b\u6807\u7684\u6700\u540e\u4e00\u6b65\u662f\u5c06 key \u7684 hash \u503c\u5bf9\u6876\u4e2a\u6570\u53d6\u6a21\uff1ahash%capacity\uff0c\u5982\u679c\u80fd\u4fdd\u8bc1 capacity \u4e3a 2 \u7684 n \u6b21\u65b9\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u64cd\u4f5c\u8f6c\u6362\u4e3a\u4f4d\u8fd0\u7b97\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static int indexFor(int h, int length) {\n    return h & (length-1);\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"5-\u6269\u5bb9-\u57fa\u672c\u539f\u7406",children:"5. \u6269\u5bb9-\u57fa\u672c\u539f\u7406"}),"\n",(0,l.jsx)(e.p,{children:"\u8bbe HashMap \u7684 table \u957f\u5ea6\u4e3a M\uff0c\u9700\u8981\u5b58\u50a8\u7684\u952e\u503c\u5bf9\u6570\u91cf\u4e3a N\uff0c\u5982\u679c\u54c8\u5e0c\u51fd\u6570\u6ee1\u8db3\u5747\u5300\u6027\u7684\u8981\u6c42\uff0c\u90a3\u4e48\u6bcf\u6761\u94fe\u8868\u7684\u957f\u5ea6\u5927\u7ea6\u4e3a N/M\uff0c\u56e0\u6b64\u67e5\u627e\u7684\u590d\u6742\u5ea6\u4e3a O(N/M)\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4e3a\u4e86\u8ba9\u67e5\u627e\u7684\u6210\u672c\u964d\u4f4e\uff0c\u5e94\u8be5\u4f7f N/M \u5c3d\u53ef\u80fd\u5c0f\uff0c\u56e0\u6b64\u9700\u8981\u4fdd\u8bc1 M \u5c3d\u53ef\u80fd\u5927\uff0c\u4e5f\u5c31\u662f\u8bf4 table \u8981\u5c3d\u53ef\u80fd\u5927\u3002HashMap \u91c7\u7528\u52a8\u6001\u6269\u5bb9\u6765\u6839\u636e\u5f53\u524d\u7684 N \u503c\u6765\u8c03\u6574 M \u503c\uff0c\u4f7f\u5f97\u7a7a\u95f4\u6548\u7387\u548c\u65f6\u95f4\u6548\u7387\u90fd\u80fd\u5f97\u5230\u4fdd\u8bc1\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u548c\u6269\u5bb9\u76f8\u5173\u7684\u53c2\u6570\u4e3b\u8981\u6709\uff1acapacity\u3001size\u3001threshold \u548c load_factor\u3002"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{style:{textAlign:"center"},children:"\u53c2\u6570"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u542b\u4e49"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"center"},children:"capacity"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"table \u7684\u5bb9\u91cf\u5927\u5c0f\uff0c\u9ed8\u8ba4\u4e3a 16\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f capacity \u5fc5\u987b\u4fdd\u8bc1\u4e3a 2 \u7684 n \u6b21\u65b9\u3002"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"center"},children:"size"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u952e\u503c\u5bf9\u6570\u91cf\u3002"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"center"},children:"threshold"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"size \u7684\u4e34\u754c\u503c\uff0c\u5f53 size \u5927\u4e8e\u7b49\u4e8e threshold \u5c31\u5fc5\u987b\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u3002"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"center"},children:"loadFactor"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u88c5\u8f7d\u56e0\u5b50\uff0ctable \u80fd\u591f\u4f7f\u7528\u7684\u6bd4\u4f8b\uff0cthreshold = (int)(capacity* loadFactor)\u3002"})]})]})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static final int DEFAULT_INITIAL_CAPACITY = 16;\n\nstatic final int MAXIMUM_CAPACITY = 1 << 30;\n\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n\ntransient Entry[] table;\n\ntransient int size;\n\nint threshold;\n\nfinal float loadFactor;\n\ntransient int modCount;\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4ece\u4e0b\u9762\u7684\u6dfb\u52a0\u5143\u7d20\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u9700\u8981\u6269\u5bb9\u65f6\uff0c\u4ee4 capacity \u4e3a\u539f\u6765\u7684\u4e24\u500d\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void addEntry(int hash, K key, V value, int bucketIndex) {\n    Entry<K,V> e = table[bucketIndex];\n    table[bucketIndex] = new Entry<>(hash, key, value, e);\n    if (size++ >= threshold)\n        resize(2 * table.length);\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u6269\u5bb9\u4f7f\u7528 resize() \u5b9e\u73b0\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6269\u5bb9\u64cd\u4f5c\u540c\u6837\u9700\u8981\u628a oldTable \u7684\u6240\u6709\u952e\u503c\u5bf9\u91cd\u65b0\u63d2\u5165 newTable \u4e2d\uff0c\u56e0\u6b64\u8fd9\u4e00\u6b65\u662f\u5f88\u8d39\u65f6\u7684\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void resize(int newCapacity) {\n    Entry[] oldTable = table;\n    int oldCapacity = oldTable.length;\n    if (oldCapacity == MAXIMUM_CAPACITY) {\n        threshold = Integer.MAX_VALUE;\n        return;\n    }\n    Entry[] newTable = new Entry[newCapacity];\n    transfer(newTable);\n    table = newTable;\n    threshold = (int)(newCapacity * loadFactor);\n}\n\nvoid transfer(Entry[] newTable) {\n    Entry[] src = table;\n    int newCapacity = newTable.length;\n    for (int j = 0; j < src.length; j++) {\n        Entry<K,V> e = src[j];\n        if (e != null) {\n            src[j] = null;\n            do {\n                Entry<K,V> next = e.next;\n                int i = indexFor(e.hash, newCapacity);\n                e.next = newTable[i];\n                newTable[i] = e;\n                e = next;\n            } while (e != null);\n        }\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"6-\u6269\u5bb9-\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807",children:"6. \u6269\u5bb9-\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u8fdb\u884c\u6269\u5bb9\u65f6\uff0c\u9700\u8981\u628a\u952e\u503c\u5bf9\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807\uff0c\u4ece\u800c\u653e\u5230\u5bf9\u5e94\u7684\u6876\u4e0a\u3002\u5728\u524d\u9762\u63d0\u5230\uff0cHashMap \u4f7f\u7528 hash%capacity \u6765\u786e\u5b9a\u6876\u4e0b\u6807\u3002HashMap capacity \u4e3a 2 \u7684 n \u6b21\u65b9\u8fd9\u4e00\u7279\u70b9\u80fd\u591f\u6781\u5927\u964d\u4f4e\u91cd\u65b0\u8ba1\u7b97\u6876\u4e0b\u6807\u64cd\u4f5c\u7684\u590d\u6742\u5ea6\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5047\u8bbe\u539f\u6570\u7ec4\u957f\u5ea6 capacity \u4e3a 16\uff0c\u6269\u5bb9\u4e4b\u540e new capacity \u4e3a 32\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-html",children:"capacity     : 00010000\nnew capacity : 00100000\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u4e8e\u4e00\u4e2a Key\uff0c\u5b83\u7684\u54c8\u5e0c\u503c hash \u5728\u7b2c 5 \u4f4d\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u4e3a 0\uff0c\u90a3\u4e48 hash%00010000 = hash%00100000\uff0c\u6876\u4f4d\u7f6e\u548c\u539f\u6765\u4e00\u81f4\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u4e3a 1\uff0chash%00010000 = hash%00100000 + 16\uff0c\u6876\u4f4d\u7f6e\u662f\u539f\u4f4d\u7f6e + 16\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h4,{id:"7-\u8ba1\u7b97\u6570\u7ec4\u5bb9\u91cf",children:"7. \u8ba1\u7b97\u6570\u7ec4\u5bb9\u91cf"}),"\n",(0,l.jsx)(e.p,{children:"HashMap \u6784\u9020\u51fd\u6570\u5141\u8bb8\u7528\u6237\u4f20\u5165\u7684\u5bb9\u91cf\u4e0d\u662f 2 \u7684 n \u6b21\u65b9\uff0c\u56e0\u4e3a\u5b83\u53ef\u4ee5\u81ea\u52a8\u5730\u5c06\u4f20\u5165\u7684\u5bb9\u91cf\u8f6c\u6362\u4e3a 2 \u7684 n \u6b21\u65b9\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5148\u8003\u8651\u5982\u4f55\u6c42\u4e00\u4e2a\u6570\u7684\u63a9\u7801\uff0c\u5bf9\u4e8e 10010000\uff0c\u5b83\u7684\u63a9\u7801\u4e3a 11111111\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u5f97\u5230\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"mask |= mask >> 1    11011000\nmask |= mask >> 2    11111110\nmask |= mask >> 4    11111111\n"})}),"\n",(0,l.jsx)(e.p,{children:"mask+1 \u662f\u5927\u4e8e\u539f\u59cb\u6570\u5b57\u7684\u6700\u5c0f\u7684 2 \u7684 n \u6b21\u65b9\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:"num     10010000\nmask+1 100000000\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f HashMap \u4e2d\u8ba1\u7b97\u6570\u7ec4\u5bb9\u91cf\u7684\u4ee3\u7801\uff1a"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static final int tableSizeFor(int cap) {\n    int n = cap - 1;\n    n |= n >>> 1;\n    n |= n >>> 2;\n    n |= n >>> 4;\n    n |= n >>> 8;\n    n |= n >>> 16;\n    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"8-\u94fe\u8868\u8f6c\u7ea2\u9ed1\u6811",children:"8. \u94fe\u8868\u8f6c\u7ea2\u9ed1\u6811"}),"\n",(0,l.jsx)(e.p,{children:"\u4ece JDK 1.8 \u5f00\u59cb\uff0c\u4e00\u4e2a\u6876\u5b58\u50a8\u7684\u94fe\u8868\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e 8 \u65f6\u4f1a\u5c06\u94fe\u8868\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\u3002"}),"\n",(0,l.jsx)(e.h4,{id:"9-\u4e0e-hashtable-\u7684\u6bd4\u8f83",children:"9. \u4e0e Hashtable \u7684\u6bd4\u8f83"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Hashtable \u4f7f\u7528 synchronized \u6765\u8fdb\u884c\u540c\u6b65\u3002"}),"\n",(0,l.jsx)(e.li,{children:"HashMap \u53ef\u4ee5\u63d2\u5165\u952e\u4e3a null \u7684 Entry\u3002"}),"\n",(0,l.jsx)(e.li,{children:"HashMap \u7684\u8fed\u4ee3\u5668\u662f fail-fast \u8fed\u4ee3\u5668\u3002"}),"\n",(0,l.jsx)(e.li,{children:"HashMap \u4e0d\u80fd\u4fdd\u8bc1\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb Map \u4e2d\u7684\u5143\u7d20\u6b21\u5e8f\u662f\u4e0d\u53d8\u7684\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"concurrenthashmap",children:"ConcurrentHashMap"}),"\n",(0,l.jsx)(e.h4,{id:"1-\u5b58\u50a8\u7ed3\u6784-1",children:"1. \u5b58\u50a8\u7ed3\u6784"}),"\n",(0,l.jsxs)(e.div,{align:"center",children:[" ",(0,l.jsx)(e.img,{src:"./images/image-20191209001038024.png"})," "]}),(0,l.jsx)(e.br,{}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static final class HashEntry<K,V> {\n    final int hash;\n    final K key;\n    volatile V value;\n    volatile HashEntry<K,V> next;\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"ConcurrentHashMap \u548c HashMap \u5b9e\u73b0\u4e0a\u7c7b\u4f3c\uff0c\u6700\u4e3b\u8981\u7684\u5dee\u522b\u662f ConcurrentHashMap \u91c7\u7528\u4e86\u5206\u6bb5\u9501\uff08Segment\uff09\uff0c\u6bcf\u4e2a\u5206\u6bb5\u9501\u7ef4\u62a4\u7740\u51e0\u4e2a\u6876\uff08HashEntry\uff09\uff0c\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u8bbf\u95ee\u4e0d\u540c\u5206\u6bb5\u9501\u4e0a\u7684\u6876\uff0c\u4ece\u800c\u4f7f\u5176\u5e76\u53d1\u5ea6\u66f4\u9ad8\uff08\u5e76\u53d1\u5ea6\u5c31\u662f Segment \u7684\u4e2a\u6570\uff09\u3002"}),"\n",(0,l.jsx)(e.p,{children:"Segment \u7ee7\u627f\u81ea ReentrantLock\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static final class Segment<K,V> extends ReentrantLock implements Serializable {\n\n    private static final long serialVersionUID = 2249069246763182397L;\n\n    static final int MAX_SCAN_RETRIES =\n        Runtime.getRuntime().availableProcessors() > 1 ? 64 : 1;\n\n    transient volatile HashEntry<K,V>[] table;\n\n    transient int count;\n\n    transient int modCount;\n\n    transient int threshold;\n\n    final float loadFactor;\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"final Segment<K,V>[] segments;\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u9ed8\u8ba4\u7684\u5e76\u53d1\u7ea7\u522b\u4e3a 16\uff0c\u4e5f\u5c31\u662f\u8bf4\u9ed8\u8ba4\u521b\u5efa 16 \u4e2a Segment\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"static final int DEFAULT_CONCURRENCY_LEVEL = 16;\n"})}),"\n",(0,l.jsx)(e.h4,{id:"2-size-\u64cd\u4f5c",children:"2. size \u64cd\u4f5c"}),"\n",(0,l.jsx)(e.p,{children:"\u6bcf\u4e2a Segment \u7ef4\u62a4\u4e86\u4e00\u4e2a count \u53d8\u91cf\u6765\u7edf\u8ba1\u8be5 Segment \u4e2d\u7684\u952e\u503c\u5bf9\u4e2a\u6570\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"/**\n * The number of elements. Accessed only either within locks\n * or among other volatile reads that maintain visibility.\n */\ntransient int count;\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u6267\u884c size \u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u904d\u5386\u6240\u6709 Segment \u7136\u540e\u628a count \u7d2f\u8ba1\u8d77\u6765\u3002"}),"\n",(0,l.jsx)(e.p,{children:"ConcurrentHashMap \u5728\u6267\u884c size \u64cd\u4f5c\u65f6\u5148\u5c1d\u8bd5\u4e0d\u52a0\u9501\uff0c\u5982\u679c\u8fde\u7eed\u4e24\u6b21\u4e0d\u52a0\u9501\u64cd\u4f5c\u5f97\u5230\u7684\u7ed3\u679c\u4e00\u81f4\uff0c\u90a3\u4e48\u53ef\u4ee5\u8ba4\u4e3a\u8fd9\u4e2a\u7ed3\u679c\u662f\u6b63\u786e\u7684\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5c1d\u8bd5\u6b21\u6570\u4f7f\u7528 RETRIES_BEFORE_LOCK \u5b9a\u4e49\uff0c\u8be5\u503c\u4e3a 2\uff0cretries \u521d\u59cb\u503c\u4e3a -1\uff0c\u56e0\u6b64\u5c1d\u8bd5\u6b21\u6570\u4e3a 3\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5982\u679c\u5c1d\u8bd5\u7684\u6b21\u6570\u8d85\u8fc7 3 \u6b21\uff0c\u5c31\u9700\u8981\u5bf9\u6bcf\u4e2a Segment \u52a0\u9501\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"\n/**\n * Number of unsynchronized retries in size and containsValue\n * methods before resorting to locking. This is used to avoid\n * unbounded retries if tables undergo continuous modification\n * which would make it impossible to obtain an accurate result.\n */\nstatic final int RETRIES_BEFORE_LOCK = 2;\n\npublic int size() {\n    // Try a few times to get accurate count. On failure due to\n    // continuous async changes in table, resort to locking.\n    final Segment<K,V>[] segments = this.segments;\n    int size;\n    boolean overflow; // true if size overflows 32 bits\n    long sum;         // sum of modCounts\n    long last = 0L;   // previous sum\n    int retries = -1; // first iteration isn't retry\n    try {\n        for (;;) {\n            // \u8d85\u8fc7\u5c1d\u8bd5\u6b21\u6570\uff0c\u5219\u5bf9\u6bcf\u4e2a Segment \u52a0\u9501\n            if (retries++ == RETRIES_BEFORE_LOCK) {\n                for (int j = 0; j < segments.length; ++j)\n                    ensureSegment(j).lock(); // force creation\n            }\n            sum = 0L;\n            size = 0;\n            overflow = false;\n            for (int j = 0; j < segments.length; ++j) {\n                Segment<K,V> seg = segmentAt(segments, j);\n                if (seg != null) {\n                    sum += seg.modCount;\n                    int c = seg.count;\n                    if (c < 0 || (size += c) < 0)\n                        overflow = true;\n                }\n            }\n            // \u8fde\u7eed\u4e24\u6b21\u5f97\u5230\u7684\u7ed3\u679c\u4e00\u81f4\uff0c\u5219\u8ba4\u4e3a\u8fd9\u4e2a\u7ed3\u679c\u662f\u6b63\u786e\u7684\n            if (sum == last)\n                break;\n            last = sum;\n        }\n    } finally {\n        if (retries > RETRIES_BEFORE_LOCK) {\n            for (int j = 0; j < segments.length; ++j)\n                segmentAt(segments, j).unlock();\n        }\n    }\n    return overflow ? Integer.MAX_VALUE : size;\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"3-jdk-18-\u7684\u6539\u52a8",children:"3. JDK 1.8 \u7684\u6539\u52a8"}),"\n",(0,l.jsx)(e.p,{children:"JDK 1.7 \u4f7f\u7528\u5206\u6bb5\u9501\u673a\u5236\u6765\u5b9e\u73b0\u5e76\u53d1\u66f4\u65b0\u64cd\u4f5c\uff0c\u6838\u5fc3\u7c7b\u4e3a Segment\uff0c\u5b83\u7ee7\u627f\u81ea\u91cd\u5165\u9501 ReentrantLock\uff0c\u5e76\u53d1\u5ea6\u4e0e Segment \u6570\u91cf\u76f8\u7b49\u3002"}),"\n",(0,l.jsx)(e.p,{children:"JDK 1.8 \u4f7f\u7528\u4e86 CAS \u64cd\u4f5c\u6765\u652f\u6301\u66f4\u9ad8\u7684\u5e76\u53d1\u5ea6\uff0c\u5728 CAS \u64cd\u4f5c\u5931\u8d25\u65f6\u4f7f\u7528\u5185\u7f6e\u9501 synchronized\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u5e76\u4e14 JDK 1.8 \u7684\u5b9e\u73b0\u4e5f\u5728\u94fe\u8868\u8fc7\u957f\u65f6\u4f1a\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"linkedhashmap",children:"LinkedHashMap"}),"\n",(0,l.jsx)(e.h4,{id:"\u5b58\u50a8\u7ed3\u6784",children:"\u5b58\u50a8\u7ed3\u6784"}),"\n",(0,l.jsx)(e.p,{children:"\u7ee7\u627f\u81ea HashMap\uff0c\u56e0\u6b64\u5177\u6709\u548c HashMap \u4e00\u6837\u7684\u5feb\u901f\u67e5\u627e\u7279\u6027\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public class LinkedHashMap<K,V> extends HashMap<K,V> implements Map<K,V>\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u7528\u6765\u7ef4\u62a4\u63d2\u5165\u987a\u5e8f\u6216\u8005 LRU \u987a\u5e8f\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"/**\n * The head (eldest) of the doubly linked list.\n */\ntransient LinkedHashMap.Entry<K,V> head;\n\n/**\n * The tail (youngest) of the doubly linked list.\n */\ntransient LinkedHashMap.Entry<K,V> tail;\n"})}),"\n",(0,l.jsx)(e.p,{children:"accessOrder \u51b3\u5b9a\u4e86\u987a\u5e8f\uff0c\u9ed8\u8ba4\u4e3a false\uff0c\u6b64\u65f6\u7ef4\u62a4\u7684\u662f\u63d2\u5165\u987a\u5e8f\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"final boolean accessOrder;\n"})}),"\n",(0,l.jsx)(e.p,{children:"LinkedHashMap \u6700\u91cd\u8981\u7684\u662f\u4ee5\u4e0b\u7528\u4e8e\u7ef4\u62a4\u987a\u5e8f\u7684\u51fd\u6570\uff0c\u5b83\u4eec\u4f1a\u5728 put\u3001get \u7b49\u65b9\u6cd5\u4e2d\u8c03\u7528\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void afterNodeAccess(Node<K,V> p) { }\nvoid afterNodeInsertion(boolean evict) { }\n"})}),"\n",(0,l.jsx)(e.h4,{id:"afternodeaccess",children:"afterNodeAccess()"}),"\n",(0,l.jsx)(e.p,{children:"\u5f53\u4e00\u4e2a\u8282\u70b9\u88ab\u8bbf\u95ee\u65f6\uff0c\u5982\u679c accessOrder \u4e3a true\uff0c\u5219\u4f1a\u5c06\u8be5\u8282\u70b9\u79fb\u5230\u94fe\u8868\u5c3e\u90e8\u3002\u4e5f\u5c31\u662f\u8bf4\u6307\u5b9a\u4e3a LRU \u987a\u5e8f\u4e4b\u540e\uff0c\u5728\u6bcf\u6b21\u8bbf\u95ee\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e2a\u8282\u70b9\u79fb\u5230\u94fe\u8868\u5c3e\u90e8\uff0c\u4fdd\u8bc1\u94fe\u8868\u5c3e\u90e8\u662f\u6700\u8fd1\u8bbf\u95ee\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u94fe\u8868\u9996\u90e8\u5c31\u662f\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u8282\u70b9\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void afterNodeAccess(Node<K,V> e) { // move node to last\n    LinkedHashMap.Entry<K,V> last;\n    if (accessOrder && (last = tail) != e) {\n        LinkedHashMap.Entry<K,V> p =\n            (LinkedHashMap.Entry<K,V>)e, b = p.before, a = p.after;\n        p.after = null;\n        if (b == null)\n            head = a;\n        else\n            b.after = a;\n        if (a != null)\n            a.before = b;\n        else\n            last = b;\n        if (last == null)\n            head = p;\n        else {\n            p.before = last;\n            last.after = p;\n        }\n        tail = p;\n        ++modCount;\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"afternodeinsertion",children:"afterNodeInsertion()"}),"\n",(0,l.jsx)(e.p,{children:"\u5728 put \u7b49\u64cd\u4f5c\u4e4b\u540e\u6267\u884c\uff0c\u5f53 removeEldestEntry() \u65b9\u6cd5\u8fd4\u56de true \u65f6\u4f1a\u79fb\u9664\u6700\u665a\u7684\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u9996\u90e8\u8282\u70b9 first\u3002"}),"\n",(0,l.jsx)(e.p,{children:"evict \u53ea\u6709\u5728\u6784\u5efa Map \u7684\u65f6\u5019\u624d\u4e3a false\uff0c\u5728\u8fd9\u91cc\u4e3a true\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"void afterNodeInsertion(boolean evict) { // possibly remove eldest\n    LinkedHashMap.Entry<K,V> first;\n    if (evict && (first = head) != null && removeEldestEntry(first)) {\n        K key = first.key;\n        removeNode(hash(key), key, null, false, true);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.p,{children:"removeEldestEntry() \u9ed8\u8ba4\u4e3a false\uff0c\u5982\u679c\u9700\u8981\u8ba9\u5b83\u4e3a true\uff0c\u9700\u8981\u7ee7\u627f LinkedHashMap \u5e76\u4e14\u8986\u76d6\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\uff0c\u8fd9\u5728\u5b9e\u73b0 LRU \u7684\u7f13\u5b58\u4e2d\u7279\u522b\u6709\u7528\uff0c\u901a\u8fc7\u79fb\u9664\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u4ece\u800c\u4fdd\u8bc1\u7f13\u5b58\u7a7a\u95f4\u8db3\u591f\uff0c\u5e76\u4e14\u7f13\u5b58\u7684\u6570\u636e\u90fd\u662f\u70ed\u70b9\u6570\u636e\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"protected boolean removeEldestEntry(Map.Entry<K,V> eldest) {\n    return false;\n}\n"})}),"\n",(0,l.jsx)(e.h4,{id:"lru-\u7f13\u5b58",children:"LRU \u7f13\u5b58"}),"\n",(0,l.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u4f7f\u7528 LinkedHashMap \u5b9e\u73b0\u7684\u4e00\u4e2a LRU \u7f13\u5b58\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u8bbe\u5b9a\u6700\u5927\u7f13\u5b58\u7a7a\u95f4 MAX_ENTRIES  \u4e3a 3\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u4f7f\u7528 LinkedHashMap \u7684\u6784\u9020\u51fd\u6570\u5c06 accessOrder \u8bbe\u7f6e\u4e3a true\uff0c\u5f00\u542f LRU \u987a\u5e8f\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u8986\u76d6 removeEldestEntry() \u65b9\u6cd5\u5b9e\u73b0\uff0c\u5728\u8282\u70b9\u591a\u4e8e MAX_ENTRIES \u5c31\u4f1a\u5c06\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u6570\u636e\u79fb\u9664\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"class LRUCache<K, V> extends LinkedHashMap<K, V> {\n    private static final int MAX_ENTRIES = 3;\n\n    protected boolean removeEldestEntry(Map.Entry eldest) {\n        return size() > MAX_ENTRIES;\n    }\n\n    LRUCache() {\n        super(MAX_ENTRIES, 0.75f, true);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:'public static void main(String[] args) {\n    LRUCache<Integer, String> cache = new LRUCache<>();\n    cache.put(1, "a");\n    cache.put(2, "b");\n    cache.put(3, "c");\n    cache.get(1);\n    cache.put(4, "d");\n    System.out.println(cache.keySet());\n}\n'})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-html",children:"[3, 1, 4]\n"})}),"\n",(0,l.jsx)(e.h3,{id:"weakhashmap",children:"WeakHashMap"}),"\n",(0,l.jsx)(e.h4,{id:"\u5b58\u50a8\u7ed3\u6784-1",children:"\u5b58\u50a8\u7ed3\u6784"}),"\n",(0,l.jsx)(e.p,{children:"WeakHashMap \u7684 Entry \u7ee7\u627f\u81ea WeakReference\uff0c\u88ab WeakReference \u5173\u8054\u7684\u5bf9\u8c61\u5728\u4e0b\u4e00\u6b21\u5783\u573e\u56de\u6536\u65f6\u4f1a\u88ab\u56de\u6536\u3002"}),"\n",(0,l.jsx)(e.p,{children:"WeakHashMap \u4e3b\u8981\u7528\u6765\u5b9e\u73b0\u7f13\u5b58\uff0c\u901a\u8fc7\u4f7f\u7528 WeakHashMap \u6765\u5f15\u7528\u7f13\u5b58\u5bf9\u8c61\uff0c\u7531 JVM \u5bf9\u8fd9\u90e8\u5206\u7f13\u5b58\u8fdb\u884c\u56de\u6536\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"private static class Entry<K,V> extends WeakReference<Object> implements Map.Entry<K,V>\n"})}),"\n",(0,l.jsx)(e.h4,{id:"concurrentcache",children:"ConcurrentCache"}),"\n",(0,l.jsx)(e.p,{children:"Tomcat \u4e2d\u7684 ConcurrentCache \u4f7f\u7528\u4e86 WeakHashMap \u6765\u5b9e\u73b0\u7f13\u5b58\u529f\u80fd\u3002"}),"\n",(0,l.jsx)(e.p,{children:"ConcurrentCache \u91c7\u53d6\u7684\u662f\u5206\u4ee3\u7f13\u5b58\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7ecf\u5e38\u4f7f\u7528\u7684\u5bf9\u8c61\u653e\u5165 eden \u4e2d\uff0ceden \u4f7f\u7528 ConcurrentHashMap \u5b9e\u73b0\uff0c\u4e0d\u7528\u62c5\u5fc3\u4f1a\u88ab\u56de\u6536\uff08\u4f0a\u7538\u56ed\uff09\uff1b"}),"\n",(0,l.jsx)(e.li,{children:"\u4e0d\u5e38\u7528\u7684\u5bf9\u8c61\u653e\u5165 longterm\uff0clongterm \u4f7f\u7528 WeakHashMap \u5b9e\u73b0\uff0c\u8fd9\u4e9b\u8001\u5bf9\u8c61\u4f1a\u88ab\u5783\u573e\u6536\u96c6\u5668\u56de\u6536\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u5f53\u8c03\u7528  get() \u65b9\u6cd5\u65f6\uff0c\u4f1a\u5148\u4ece eden \u533a\u83b7\u53d6\uff0c\u5982\u679c\u6ca1\u6709\u627e\u5230\u7684\u8bdd\u518d\u5230 longterm \u83b7\u53d6\uff0c\u5f53\u4ece longterm \u83b7\u53d6\u5230\u5c31\u628a\u5bf9\u8c61\u653e\u5165 eden \u4e2d\uff0c\u4ece\u800c\u4fdd\u8bc1\u7ecf\u5e38\u88ab\u8bbf\u95ee\u7684\u8282\u70b9\u4e0d\u5bb9\u6613\u88ab\u56de\u6536\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u5f53\u8c03\u7528 put() \u65b9\u6cd5\u65f6\uff0c\u5982\u679c eden \u7684\u5927\u5c0f\u8d85\u8fc7\u4e86 size\uff0c\u90a3\u4e48\u5c31\u5c06 eden \u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u90fd\u653e\u5165 longterm \u4e2d\uff0c\u5229\u7528\u865a\u62df\u673a\u56de\u6536\u6389\u4e00\u90e8\u5206\u4e0d\u7ecf\u5e38\u4f7f\u7528\u7684\u5bf9\u8c61\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-java",children:"public final class ConcurrentCache<K, V> {\n\n    private final int size;\n\n    private final Map<K, V> eden;\n\n    private final Map<K, V> longterm;\n\n    public ConcurrentCache(int size) {\n        this.size = size;\n        this.eden = new ConcurrentHashMap<>(size);\n        this.longterm = new WeakHashMap<>(size);\n    }\n\n    public V get(K k) {\n        V v = this.eden.get(k);\n        if (v == null) {\n            v = this.longterm.get(k);\n            if (v != null)\n                this.eden.put(k, v);\n        }\n        return v;\n    }\n\n    public void put(K k, V v) {\n        if (this.eden.size() >= size) {\n            this.longterm.putAll(this.eden);\n            this.eden.clear();\n        }\n        this.eden.put(k, v);\n    }\n}\n"})}),"\n",(0,l.jsx)(e.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Eckel B. Java \u7f16\u7a0b\u601d\u60f3 [M]. \u673a\u68b0\u5de5\u4e1a\u51fa\u7248\u793e, 2002."}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.w3resource.com/java-tutorial/java-collections.php",children:"Java Collection Framework"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://openhome.cc/Gossip/DesignPattern/IteratorPattern.htm",children:"Iterator \u6a21\u5f0f"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://tech.meituan.com/java_hashmap.html",children:"Java 8 \u7cfb\u5217\u4e4b\u91cd\u65b0\u8ba4\u8bc6 HashMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://javarevisited.blogspot.hk/2010/10/difference-between-hashmap-and.html",children:"What is difference between HashMap and Hashtable in Java?"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://www.zhangchangle.com/2018/02/07/Java%E9%9B%86%E5%90%88%E4%B9%8BHashMap/",children:"Java \u96c6\u5408\u4e4b HashMap"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://www.programering.com/a/MDO3QDNwATM.html",children:"The principle of ConcurrentHashMap analysis"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.ibm.com/developerworks/cn/java/java-lo-concurrenthashmap/",children:"\u63a2\u7d22 ConcurrentHashMap \u9ad8\u5e76\u53d1\u6027\u7684\u5b9e\u73b0\u673a\u5236"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://www.jianshu.com/p/75adf47958a7",children:"HashMap \u76f8\u5173\u9762\u8bd5\u9898\u53ca\u5176\u89e3\u7b54"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://wiki.jikexueyuan.com/project/java-enhancement/java-thirtysix.html",children:"Java \u96c6\u5408\u7ec6\u8282\uff08\u4e8c\uff09\uff1aasList \u7684\u7f3a\u9677"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"http://javaconceptoftheday.com/java-collection-framework-linkedlist-class/",children:"Java Collection Framework \u2013 The LinkedList Class"})}),"\n"]})]})}function o(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}},28453:(n,e,a)=>{a.d(e,{R:()=>t,x:()=>r});var i=a(96540);const l={},s=i.createContext(l);function t(n){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);